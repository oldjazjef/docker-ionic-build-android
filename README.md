
# docker file for ionic android apk generation

This repository contains a ionic5 sample project and a docker file which can be used to dockerize the apk build process.
The docker images is optimized to use capacitor.


If you find something missing or broken, please report an issue or even better fork the repo and submit a pull request


### How it works
The docker images downloads the currently latest commandline tools from google.
Sets up all the important environment variables to use the tools.
The ionic build & capacitor android platform build happens outside of the docker image.

By using ionic & capacitor, the android project files are generated, which will be copied into the docker image.
After all the dependencies have been installed, the debug and release apks are built with gradle(w).

Make sure to copy parts of the node_modules folder since some are needed by capacitor settings.
```javascript
# android/capacitor.settings.gradle - generated by capacitor

include ':capacitor-android'
project(':capacitor-android').projectDir = new File('../../../node_modules/@capacitor/android/capacitor')


```

#### dockerfile

```dockerfile
FROM openjdk:11

# install common deps
RUN apt update
RUN apt -y install wget
RUN apt -y install unzip
RUN apt -y install gradle

# deps for building app within container
# RUN apt -y install nodejs
# RUN apt -y install npm
# RUN npm install -g @ionic/cli
# RUN npm i -g @capacitor/cli
# RUN npm i -g @capacitor/android

# download android sdk
RUN mkdir android-sdk
RUN wget https://dl.google.com/android/repository/commandlinetools-linux-6200805_latest.zip
RUN unzip commandlinetools-linux-6200805_latest -d /android-sdk/
RUN rm -rf commandlinetools-linux-6200805_latest

# setup environment variables
#java
ENV JAVA_HOME /usr/local/openjdk-11
ENV PATH $PATH:$JAVA_HOME/bin/
# android and tools
ENV ANDROID_HOME /android-sdk/
ENV ANDROID_SDK_ROOT $ANDROID_HOME
ENV PATH $PATH:$ANDROID_SDK_ROOT/tools/bin
ENV PATH $PATH:$ANDROID_SDK_ROOT/platform-tools/bin

# setup sdkmanager
RUN /android-sdk/tools/bin/sdkmanager --update --sdk_root=${ANDROID_HOME}
RUN yes | /android-sdk/tools/bin/sdkmanager --licenses --sdk_root=${ANDROID_HOME}

# copy project source including node_modules because capacitor / cordova depend on it for building
COPY ./ android-build

# build debug apk
RUN cd android-build/projects/client/android && ./gradlew assembleDebug
# build release apk
RUN cd android-build/projects/client/android && ./gradlew assembleRelease

```

## Usage

### gitlab
... coming soon ..


## Upcoming changes
- Parameterize container
- APK signing
